(()=>{"use strict";var e={};function s(e,s,t){const r=s;if("ok"===r.status){let s="block-message-user",n="block-name-user",c="block-text";r.message.user===t&&(s="block-message-self",n="block-name-self",c="block-text-self",r.message.user="Вы"),e.insertAdjacentHTML("beforeend",`\n      <div class="${s}">\n        <div class="${n}">\n          <div class="text-user-name">${r.message.user}</div>\n          <div class="date-time">${r.message.time}</div>\n        </div>\n        <div class="${c}">${r.message.text}</div>\n      </div>\n    `)}}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var s;e.g.importScripts&&(s=e.g.location+"");var t=e.g.document;if(!s&&t&&(t.currentScript&&(s=t.currentScript.src),!s)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&!s;)s=r[n--].src}if(!s)throw new Error("Automatic publicPath is not supported in this browser");s=s.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=s})();const t=new WebSocket("ws://localhost:7070/ws"),r=document.querySelector(".container-set-nick"),n=r.querySelector(".nick-send"),c=document.querySelector(".block-messages"),o=document.querySelector(".chat-message"),a=document.querySelector(".chat-send");let i;n.addEventListener("click",(()=>{const e=r.querySelector(".nick-input");r.querySelector(".message-error").innerText="";const s=e.value.trim();if(""===s)return;const n=JSON.stringify({sendler:"setNickname",text:s});t.send(n),i=s})),a.addEventListener("click",(()=>{const e=o.value;if(!e||!i)return;const s=JSON.stringify({sendler:"setMessage",text:e});t.send(s),o.value=""})),t.addEventListener("open",(()=>{})),t.addEventListener("close",(()=>{})),t.addEventListener("error",(e=>{console.log(e),console.log("ws error")})),t.addEventListener("message",(e=>{const t=JSON.parse(e.data);"setNickname"===t.sendler&&"error"===function(e,s,t){const r=e.querySelector(".nick-input"),n=e.querySelector(".message-error");return"error"===s.status?(n.innerText="Псевдоним занят, выбери другой.",r.value=s.errorNick,"error"):(function(e,s){const t=document.querySelector(".block-users");let r;t.innerHTML="",e.forEach((e=>{r="",e.username===s&&(r="self-nick"),t.insertAdjacentHTML("beforeend",`\n      <div class="user">\n        <img class="user-ava" src="./images/${e.ava}">\n        <div class="user-name ${r}">${e.username}</div>\n      </div>\n    `)}))}(s.users,t),r.value="",e.classList.add("hidden"),"ok")}(r,t.text,i)&&(i=void 0),"setMessage"===t.sendler&&s(c,t.text,i),"setAllMessage"===t.sendler&&function(e,t,r){const n=e;n.innerHTML="","ok"===t.status&&t.messages.forEach((e=>{s(n,{status:"ok",message:e},r)}))}(c,t.text,i)})),e.p,e.p,e.p,e.p,e.p,e.p})();